The Box class is an extension of the [Phar](http://php.net/class.phar) class.

## API

### __construct($fname, $flags = 0, $alias = null)

Accepts the same arguments as the original [`Phar::__construct()`](http://php.net/phar.construct) method.

> NOTE: The only difference between this method and the original is that the alias is kept by this class.

### compactSource($source)

Returns a compacted version of the source code.

- Comments are removed.
- Leading and trailing white space is removed.
- Windows line endings are converted to Unix.
- Empty lines are kept in order to preserve line count for debugging.

If `setCompactor()` was used, the custom compactor will be called after the source code has been altered.

### createStub()

Returns a generated stub.

The stub is generated

- using the PHAR alias in `mapPhar()` (see `__construct()`)
- if applicable, adds `interceptFileFuncs()` call (see `setIntercept()`)
- if applicable, loads the main script (see `importFile()` and `importSource()`)

**Example**

```php
<?php

#!/usr/bin/env php
<?php

/**
 * Genereated by Box: http://github.com/kherge/Box
 */

Phar::mapPhar('example.phar');

Phar::interceptFileFuncs();

require 'phar://{$this->alias}/{$this->main}';

__HALT_COMPILER();
```

### doReplacements($source)

Returns the source code with the placeholders replace with the values set by `setReplacements()`.

**Example**

Before:

```php
<?php $name = '@name@';
```

After:

```php
<?php $name = 'My Name';
```

### importFile($absolute, $relative, $main = false)

Reads the source file and calls `importSource()`.

### importSource($relative, $source, $main = false)

Imports the source code by compacting it (if it is a PHP script), performing replacements, and passes it to `Phar::addFromString()`.  If `$main` is `true`, the `#!` line will be removed and it will be loaded in the stub generated by `createStub()`.

### setCompactor(Closure $compactor)

Sets the custom compactor to be called by `compactSource()`.

### setIntercept($toggle)

Toggles whether `Phar::interceptFileFuncs()` should be called in the stub generated by `createSub()`.

### setReplacements(array $replacements)

Sets the replacement values used by `doReplacements()`.

### setStubFile($file, $replace = false)

Sets the stub using an existing file.  If `$replace` is `true`, then `doReplacements()` will be called on the source code that is read from the file.

### usePrivateKeyFile($file, $pass = null)

Signs the PHAR using the specified private key file (and optionally, passphrase).